<!DOCTYPE html>
<html>
<head>
    <title><%= title %></title>
    <!--<link rel="stylesheet" href="/assets/css/amazeui.min.css"/>-->
    <link rel="stylesheet" href="/assets/css/amazeui.flat.min.css"/>
    <link rel='stylesheet' href='/css/style.css'/>
</head>
<body>
    <div class="am-container">
        <div class="am-g">
            <div class="am-panel-default am-u-sm-4 am-u-xs-4">
                <section class=" am-panel am-panel-primary">
                    <header class="am-panel-hd">
                        <h3 class="am-panel-title">好友列表</h3>
                    </header>
                    <div class="am-panel-bd">
                        <ul class="friendList">
                            <!--<li class="active am-animation-slide-bottom">-->
                                <!--<img src="/images/shuijiao.jpg" alt="" class="am-circle">-->
                                <!--<span>名称</span>-->
                            <!--</li>-->
                            <!--<li class="am-animation-slide-bottom">-->
                                <!--<img src="/images/shuijiao.jpg" alt="" class="am-circle">-->
                                <!--<span>32141234567890gdhjfdsdksj</span>-->
                            <!--</li>-->
                            <!--<li class="am-animation-slide-bottom">-->
                                <!--<img src="/images/shuijiao.jpg" alt="" class="am-circle">-->
                                <!--<span>名称</span>-->
                            <!--</li>-->
                            <!--<li class="am-animation-slide-bottom">-->
                                <!--<img src="/images/shuijiao.jpg" alt="" class="am-circle">-->
                                <!--<span>名称</span>-->
                            <!--</li>-->
                            <!--<li class="am-animation-slide-bottom">-->
                                <!--<img src="/images/shuijiao.jpg" alt="" class="am-circle">-->
                                <!--<span>名称</span>-->
                            <!--</li>-->
                            <!--<li class="am-animation-slide-bottom">-->
                                <!--<img src="/images/shuijiao.jpg" alt="" class="am-circle">-->
                                <!--<span>名称</span>-->
                            <!--</li>-->
                            <!--<li class="am-animation-slide-bottom">-->
                                <!--<img src="/images/shuijiao.jpg" alt="" class="am-circle">-->
                                <!--<span>名称</span>-->
                            <!--</li>-->
                            <!--<li class="am-animation-slide-bottom">-->
                                <!--<img src="/images/shuijiao.jpg" alt="" class="am-circle">-->
                                <!--<span>名称</span>-->
                            <!--</li>-->
                            <!--<li class="am-animation-slide-bottom">-->
                                <!--<img src="/images/shuijiao.jpg" alt="" class="am-circle">-->
                                <!--<span>名称</span>-->
                            <!--</li>-->

                        </ul>
                    </div>
                    <!--<footer class="am-panel-footer">面板页脚</footer>-->
                </section>
            </div>
            <div class="am-panel-default  am-u-sm-8 am-u-xs-8">
                <section class=" am-panel am-panel-primary">
                    <header class="am-panel-hd">
                        <h3 class="am-panel-title" id="myNicName">昵称</h3>
                    </header>
                    <div class="am-panel-bd" id="messageList">
                        <!--<div class="message left am-animation-slide-bottom">-->
                            <!--<div class="body">-->
                                <!--ghjkl;'ghjkl;'ghjkl;'ghjkl;'ghjkl;'ghjkl;'ghjkl;'ghjkl;'ghjkl;'ghjkl;'ghjkl;'ghjkl;'ghjkl;'ghjkl;'ghjkl;'ghjkl;'ghjkl;'ghjkl;'ghjkl;'ghjkl;'-->
                            <!--</div>-->
                        <!--</div>-->
                        <!--<div class="message right am-animation-slide-bottom">-->
                            <!--<div class="body">-->
                                <!--ghjkl;'ghjkl;'ghjkl;'ghjkl;'ghjkl;'ghjkl;'ghjkl;'ghjkl;'ghjkl;'ghjkl;'ghjkl;'ghjkl;'ghjkl;'ghjkl;'ghjkl;'ghjkl;'ghjkl;'ghjkl;'ghjkl;'ghjkl;'-->
                            <!--</div>-->
                        <!--</div>-->
                    </div>
                    <footer class="am-panel-footer">
                        <div class="am-btn-toolbar">
                            <div class="am-btn-group">
                                <a class="am-btn am-btn-primary" href="#">
                                    <i class="am-icon-smile-o"></i>
                                </a>
                            </div>
                            <div class="am-btn-group">
                                <a class="am-btn am-btn-primary" href="#">
                                    <i class="am-icon-image"></i>
                                </a>
                            </div>
                            <div class="am-btn-group">
                                <a class="am-btn am-btn-primary" href="#">
                                    <i class="am-icon-file"></i>
                                </a>
                            </div>
                        </div>
                    </footer>
                </section>
                <div class="am-input-group">
                    <input type="text" class="am-form-field" placeholder="请输入聊天内容">
                        <span class="am-input-group-label">
                            <a class="am-btn am-btn-primary" href="#" id="sendBtn">
                                <i class="am-icon-send"></i>
                                发送
                            </a>
                        </span>
                </div>
            </div>
        </div>
    </div>

    <div class="am-modal am-modal-no-btn" tabindex="-1" id="login-model">
        <div class="am-modal-dialog">
            <div class="am-modal-hd">用户登录
                <!--<a href="javascript: void(0)" class="am-close am-close-spin" data-am-modal-close>&times;</a>-->
            </div>
            <div class="am-modal-bd">
                <form class="am-form am-form-horizontal">
                    <div class="am-form-group">
                        <label for="doc-ipt-3" class="am-u-sm-2 am-form-label">用户名</label>
                        <div class="am-u-sm-10">
                            <input type="text" placeholder="请输入用户名">
                        </div>
                    </div>

                    <div class="am-form-group">
                        <label for="doc-ipt-pwd-2" class="am-u-sm-2 am-form-label">密码</label>
                        <div class="am-u-sm-10">
                            <input type="password" placeholder="请输入密码">
                        </div>
                    </div>

                    <div class="am-form-group">
                        <div class="am-u-sm-2 am-u-sm-offset-9">
                            <button type="submit" class="am-btn am-btn-primary" onclick="login()">登录</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

</body>
<script src="/js/socket.io.min.js"></script>
<script src="/js/jquery.min.js"></script>
<script src="/assets/js/amazeui.min.js"></script>
<script type="text/javascript">
    jQuery(document).ready(function () {
        (function ($) {

            var socketHandle = new SocketHandle();
            socketHandle.init();

        })(jQuery);

    });

    var SocketHandle = function(){
        this.socket = null;
        this.msgHandel = null;
    }

    var MessageHandel = function(){}

    SocketHandle.prototype = {
        init : function(){
            var that = this;
            //建立到服务器的socket连接
            this.socket = io.connect();
            //监听socket的connect事件，此事件表示连接已经建立
            this.msgHandel = new MessageHandel();
            this.msgHandel.init(that);

            this.socket.on('connect', function(data) {
                //连接到服务器后，显示昵称输入框
                console.log("socket 连接成功")
                console.log(data);
            })

            this.socket.on('aaa', function(data) {
                //连接到服务器后，显示昵称输入框
                console.log("socket 连接测试")
                console.log(data);
                if(data!=""){
                    that.msgHandel.addToMsgBox(data,true);
                }
            })

            this.socket.on('joinIn', function(data) {
                //连接到服务器后，显示昵称输入框
                that.msgHandel.addFriend(data);
            })
        },
        sendMsg : function(data){
            this.socket.emit("msg",data);
        }
    }

    MessageHandel.prototype = {
        init : function(socket){
            var that = this;
            $("#sendBtn").on('click',function(){
                var content = $(this).parent().prev().val();
                $(this).parent().prev().val("");
                if(content != ""){
                    that.addToMsgBox(content,false);
                    socket.sendMsg(content);
                }
            })
        },
        addFriend : function(name){
            var html ="";
            name.forEach(function(item){
                html += '<li class="am-animation-slide-bottom"> <img src="/images/shuijiao.jpg" alt="" class="am-circle"> <span>'+item.id+'</span></li>';
            })
            $(".friendList").html(html);
        }
        ,
        addToMsgBox : function(content,isSend){
            var html = "";
            if(isSend){
                html += '<div class="message left am-animation-slide-bottom"> <div class="body">'+content+'</div></div>'
            }else{
                html += '<div class="message right am-animation-slide-bottom"> <div class="body">'+content+'</div></div>'
            }
            $("#messageList").append(html)
        }
    }

    var login = function () {
        $('#login-model').modal();
    }
</script>
</html>
