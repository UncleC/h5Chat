<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <title><%= title %></title>
    <!--<link rel="stylesheet" href="/assets/css/amazeui.min.css"/>-->
    <link rel="stylesheet" href="/assets/css/amazeui.flat.min.css"/>
    <!--<link rel="stylesheet" href="/css/swiper-3.3.1.min.css"/>-->
    <link rel='stylesheet' href='/css/style.css'/>
</head>
<body>

    <div class="am-container">
        <div class="am-g">
            <div class="am-panel-default am-u-sm-4 am-u-xs-4">
                <section class="am-panel am-panel-secondary">
                    <header class="am-panel-hd">
                        <h3 class="am-panel-title">个人信息</h3>
                    </header>
                    <div class="am-panel-bd myUserInfo">
                        <img src="/images/shuijiao.jpg" alt="" class="am-circle">
                        <span id="myId"></span>
                    </div>
                    <!--<footer class="am-panel-footer">面板页脚</footer>-->
                </section>

                <section class=" am-panel am-panel-primary">
                    <header class="am-panel-hd">
                        <h3 class="am-panel-title">好友列表</h3>
                    </header>
                    <div class="am-panel-bd">
                        <ul class="friendList">


                        </ul>
                    </div>
                    <!--<footer class="am-panel-footer">面板页脚</footer>-->
                </section>
            </div>
            <div class="am-panel-default  am-u-sm-8 am-u-xs-8">
                <section class=" am-panel am-panel-primary">
                    <header class="am-panel-hd">
                        <h3 class="am-panel-title" id="myNicName">昵称</h3>
                    </header>
                    <div class="am-panel-bd" id="messageList">

                    </div>
                    <footer class="am-panel-footer">
                        <div class="am-btn-toolbar">
                            <div class="am-btn-group">
                                <!--<input type="file" class="input-cover emoji">-->
                                <div class="am-slider am-slider-default emjoyPanel" id="emjoy-slider">
                                    <ul class="am-slides"></ul>
                                </div>
                                <a class="am-btn am-btn-primary" id="selectEmjoy">
                                    <i class="am-icon-smile-o"></i>
                                </a>
                            </div>
                            <div class="am-btn-group">
                                <input type="file" class="input-cover image">
                                <a class="am-btn am-btn-primary" href="#">
                                    <i class="am-icon-image"></i>
                                </a>
                            </div>
                            <div class="am-btn-group">
                                <form method="post" enctype="multipart/form-data" id="fileFormId">
                                    <input type="file" name="files" multiple='mutiple'>
                                    <a class="am-btn am-btn-primary" href="#">
                                        <i class="am-icon-file"></i>
                                    </a>
                                </form>
                            </div>
                        </div>
                    </footer>
                </section>
                <div class="am-input-group">
                    <input type="text" class="am-form-field" placeholder="请输入聊天内容" id="chatText">
                        <span class="am-input-group-label">
                            <a class="am-btn am-btn-primary" href="#" id="sendBtn">
                                <i class="am-icon-send"></i>
                                发送
                            </a>
                        </span>
                </div>
            </div>
        </div>
    </div>

    <div class="am-modal am-modal-no-btn" tabindex="-1" id="login-model">
        <div class="am-modal-dialog">
            <div class="am-modal-hd">用户登录
                <!--<a href="javascript: void(0)" class="am-close am-close-spin" data-am-modal-close>&times;</a>-->
            </div>
            <div class="am-modal-bd">
                <form class="am-form am-form-horizontal">
                    <div class="am-form-group">
                        <label for="doc-ipt-3" class="am-u-sm-2 am-form-label">用户名</label>
                        <div class="am-u-sm-10">
                            <input type="text" name="username" placeholder="请输入用户名">
                        </div>
                    </div>

                    <div class="am-form-group">
                        <label for="doc-ipt-pwd-2" class="am-u-sm-2 am-form-label">密码</label>
                        <div class="am-u-sm-10">
                            <input type="password" name="password" placeholder="请输入密码">
                        </div>
                    </div>

                    <div class="am-form-group">
                        <div class="am-u-sm-2 am-u-sm-offset-9">
                            <button type="button" class="am-btn am-btn-primary" onclick="login()">登录</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

</body>
<script src="/js/socket.io.js"></script>
<script src="/js/jquery.js"></script>
<script src="/assets/js/amazeui.min.js"></script>
<script src="/js/emjoyHandle.js"></script>
<script src="/js/socketHandle.js"></script>
<script src="/js/MessageHandle.js"></script>
<script src="/js/fileHandle.js"></script>
<script type="text/javascript">
    var userObj = {
        nick:"",
        uId:""
    }

    var receiveUserObj = {
        nick:"",
        uId:""
    }

    var socketHandle;

    jQuery(document).ready(function () {
            $("#login-model").modal();

    });

    /**
     * 登录实现
     */
    var login = function () {
        var username = $("input[name='username']").val();
        var password = $("input[name='password']").val();
        $.post("/loginCheck",{username:username,password:password},function(data){
            if(data.reusltCode != 1){
                alert(data.message);
            }else{
                //初始化用户对象
                userObj.nick = $("input[name='username']").val();
                userObj.uId = "uId"+userObj.nick+new Date().getTime();
                $("#myId").text(userObj.nick);

                //初始化socket连接
                socketHandle = new SocketHandle();
                socketHandle.init();
                userObj.id = socketHandle.getSocketId();
                socketHandle.login(userObj);
                $('#login-model').modal();
                //初始化文件处理
                var fileHandle = new FileHandle();
                fileHandle.init();
            }
        })
    }

    /**
     * 进度条
     */
    var progress = $.AMUI.progress;
    progress.configure({
        minimum: 0.1,
        easing: 'ease-in-out',
        positionUsing: '',
        speed: 200,
        trickle: true,
        trickleRate: 0.02,
        trickleSpeed: 800,
        showSpinner: true,
        barSelector: '[role="nprogress-bar"]',
        spinnerSelector: '[role="nprogress-spinner"]',
        parent: 'body',
        template: '<div class="nprogress-bar" role="nprogress-bar">' +
        '<div class="nprogress-peg"></div></div>' +
        '<div class="nprogress-spinner" role="nprogress-spinner">' +
        '<div class="nprogress-spinner-icon"></div></div>'
    })

    $(document).ready(function(){
        var html = "";
        for(var i=0;i<=170;i++){
            if(i%40===0){
                html += "<li>";
            }
            if(i%8===0){
                html += "<img src='/emjoy/"+i+".png' class='isLeft' emjoy-target='[:emjoy"+i+"]'/>";
            }else{
                html += "<img src='/emjoy/"+i+".png' emjoy-target='[:emjoy"+i+"]'/>";
            }
            if(i%40 === 39 || i===170){
                html += "</li>"
            }
        }
        $("#emjoy-slider ul").html(html);
        $("#emjoy-slider").flexslider({
            animation: "slide",
            easing: "swing",
            direction: "horizontal",
            animationLoop: false,
            slideshow:false,
            directionNav:false
        })
        $("#emjoy-slider ul li img").click(function(){
            document.getElementById("chatText").value += $(this).attr("emjoy-target");
        })
        $("#emjoy-slider").mouseleave(function(){
            $("#emjoy-slider").css("display","none");
        })
        $("#selectEmjoy").click(function(){
            $("#emjoy-slider").toggle();
        })
//        $("#emjoy-slider").css("display","none");
    })

</script>
</html>
